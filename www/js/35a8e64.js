(function(c,d,b){var a={post:function(f,g,i,e){var h=function(j){if("undefined"!==typeof e){e(j.responseText,j.status)}};d.post(f,g,i).error(h)},get:function(f,g,i,e){var h=function(j){if("undefined"!==typeof e){e(j.responseText,j.status)}};d.get(f,g,i).error(h)},getThreadComments:function(e,f){if("undefined"==typeof f){f=c.location.href}a.get(a.base_url+"/"+encodeURIComponent(e)+"/comments",{permalink:encodeURIComponent(f)},function(g){a.thread_container.html(g);a.thread_container.attr("data-thread",e)})},initializeListeners:function(){a.thread_container.on("submit","form.fos_comment_comment_new_form",function(g){var f=d(this);a.post(this.action,a.serializeObject(this),function(h,e){a.appendComment(h,f)},function(i,h){var e=f.parent();e.after(i);e.remove()});g.preventDefault()});a.thread_container.on("click",".fos_comment_comment_reply_show_form",function(g){var h=d(this).data();var f=this;a.get(h.url,{parentId:h.parentId},function(e){d(f).parent().addClass("fos_comment_replying");d(f).after(e)})});a.thread_container.on("click",".fos_comment_comment_reply_cancel",function(g){var f=d(this).parent().parent().parent();f.parent().removeClass("fos_comment_replying");f.remove()});a.thread_container.on("click",".fos_comment_comment_edit_show_form",function(g){var h=d(this).data();var f=this;a.get(h.url,{},function(e){var i=d(f).parent().next();i.data("original",i.html());i.html(e)})});a.thread_container.on("submit","form.fos_comment_comment_edit_form",function(g){var f=d(this);a.post(this.action,a.serializeObject(this),function(e){a.editComment(e)},function(i,h){var e=f.parent();e.after(i);e.remove()});g.preventDefault()});a.thread_container.on("click",".fos_comment_comment_edit_cancel",function(f){a.cancelEditComment(d(this).parents(".fos_comment_comment_body"))});a.thread_container.on("click",".fos_comment_comment_vote",function(f){var g=d(this).data();a.get(g.url,{},function(h){var e=d(h).children("form")[0];var i=d(e).data();a.post(e.action,a.serializeObject(e),function(j){d("#"+i.scoreHolder).html(j)})})});a.thread_container.on("click",".fos_comment_comment_remove",function(f){var g=d(this).data();a.get(g.url,{},function(h){var e=d(h).children("form")[0];a.post(e.action,a.serializeObject(e),function(k){var i=d(k);var j=d("#"+i.attr("id"));j.replaceWith(i)})})});a.thread_container.on("click",".fos_comment_thread_commentable_action",function(f){var g=d(this).data();a.get(g.url,{},function(h){var e=d(h).children("form")[0];a.post(e.action,a.serializeObject(e),function(j){var i=d(j).children("form")[0];var k=d(i).data().fosCommentThreadId;a.getThreadComments(k)})})})},appendComment:function(f,g){var i=g.data();if(""!=i.parent){var e=g.parent();var h=e.parent();h.removeClass("fos_comment_replying");h.after(f);e.remove()}else{g.after(f);g=d(g[0]);g.find("textarea").val("");g.children(".fos_comment_form_errors").remove()}},editComment:function(e){var e=d(e);var f=d("#"+e.attr("id")).children(".fos_comment_comment_body");f.html(e.children(".fos_comment_comment_body").html())},cancelEditComment:function(e){e.html(e.data("original"))},serializeObject:function(f){var g={};var e=d(f).serializeArray();d.each(e,function(){if(g[this.name]!==undefined){if(!g[this.name].push){g[this.name]=[g[this.name]]}g[this.name].push(this.value||"")}else{g[this.name]=this.value||""}});return g},loadCommentCounts:function(){var e=[];var f=d("span.fos-comment-count");f.each(function(g,h){var j=d(h).data("fosCommentThreadId");if(j){e.push(j)}});a.get(a.base_url+".json",{ids:e},function(j){if(typeof j!="object"){j=jQuery.parseJSON(j)}var h={};for(var g in j.threads){h[j.threads[g].id]=j.threads[g]}d.each(f,function(){var i=d(this).data("fosCommentThreadId");if(i){a.setCommentCount(this,h[i])}})})},setCommentCount:function(f,e){if(e==undefined){f.innerHTML="0";return}f.innerHTML=e.num_comments}};a.thread_container=c.fos_comment_thread_container||d("#fos_comment_thread");if(typeof c.fos_comment_remote_cors_url!="undefined"){a.easyXDM=b.noConflict("FOS_COMMENT");a.request=function(k,f,h,j,e){var g=function(l){if("undefined"!==typeof j){j(l.data,l.status)}};var i=function(l){if("undefined"!==typeof e){e(l.data.data,l.data.status)}};a.xhr.request({url:f,method:k,data:h},g,i)};a.post=function(f,g,h,e){this.request("POST",f,g,h,e)};a.get=function(f,g,i,e){var h=jQuery.param(g);f+=""!=h?"?"+h:"";this.request("GET",f,undefined,i,e)};a.xhr=new a.easyXDM.Rpc({remote:c.fos_comment_remote_cors_url},{remote:{request:{}}})}a.base_url=c.fos_comment_thread_api_base_url;if(typeof c.fos_comment_thread_id!="undefined"){a.getThreadComments(c.fos_comment_thread_id)}if(typeof c.fos_comment_thread_comment_count_callback!="undefined"){a.setCommentCount=c.fos_comment_thread_comment_count_callback}if(d("span.fos-comment-count").length>0){a.loadCommentCounts()}a.initializeListeners();c.fos=c.fos||{};c.fos.Comment=a})(window,window.jQuery,window.easyXDM);